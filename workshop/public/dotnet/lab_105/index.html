<!DOCTYPE html>



<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="Raytheon Pivotal Workshops">
		<link rel="icon" href="/favicon.ico">
		<title>Lab105 - Raytheon Pivotal Workshops</title>
		<link rel="stylesheet" href="/css/highlight.js.min.css">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootstrap-theme.css">
		<link rel="stylesheet" href="/css/pui-v2.0.0/pivotal-ui.css">
		<link rel="stylesheet" href="/css/theme.css">
		<link rel="stylesheet" href="/css/component.css">

<link rel="stylesheet"  href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.1.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="/css/bootie-docs.css">
		<script src="http://raytheon.cfapps.io/js/modernizr.custom.js"></script>

		
		<style type="text/css">
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
		</style>
	</head>

<body role="document">
	
	
	<nav class="navbar navbar-inverse navbar-fixed-top  ">
		<div class="container-fluid">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<div class="nav navbar-brand">
						
							<img class="nav pivotal-logo" src="/Pivotal_Teal.png"/>
						
				</div>
				<a class="navbar-brand navbar-txt" href="/">Raytheon Pivotal Workshops </a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
			
				
				
					
					<li ><a class="navbar-txt" href="/lab_requirements">Lab_requirements</a></li>
				
					
					<li ><a class="navbar-txt" href="/billerica_day1">Billerica_day1</a></li>
				
					
					<li ><a class="navbar-txt" href="/billerica_day2">Billerica_day2</a></li>
				
					
					<li ><a class="navbar-txt" href="/billerica_day3">Billerica_day3</a></li>
				
					
					<li ><a class="navbar-txt" href="/cloud_tig">Cloud_tig</a></li>
				
			
			
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Resources<span class="caret"></span></a>
					<ul class="dropdown-menu" role="menu">
					
                        <li><a target="_blank" href="https://www.youtube.com/playlist?list=PLAdzTan_eSPQ1fuLSBhyB4eEZF7JQM0Mx">All SpringOne Conference Videos</a></li>
                     
                        <li><a target="_blank" href="http://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry-dev/introduction">Try PCF on your Local Workstation with PCF Dev</a></li>
                     
                        <li><a target="_blank" href="http://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry/introduction">Try PCF on the Public Cloud</a></li>
                     
                        <li><a target="_blank" href="/CorporateOverview.pdf">Pivotal Overview</a></li>
                     
                        <li><a target="_blank" href="https://network.pivotal.io/products/pcfdev">PCF Dev</a></li>
                     
                        <li><a target="_blank" href="https://docs.pivotal.io/pivotalcf">PCF Documentation</a></li>
                     
                        <li><a target="_blank" href="https://docs.pivotal.io/pivotalcf/cf-cli/getting-started.html">CF CLI Documentation</a></li>
                     
                        <li><a target="_blank" href="https://www.git-scm.com">Git</a></li>
                     
                        <li><a target="_blank" href="https://try.github.io/levels/1/challenges/1">Git Lessons</a></li>
                     
                        <li><a target="_blank" href="http://platform.spring.io/platform/">Spring Platform</a></li>
                     
                        <li><a target="_blank" href="https://spring.io/docs">Spring Docs</a></li>
                     
                        <li><a target="_blank" href="http://start.spring.io/">Spring Initializer</a></li>
                     
                        <li><a target="_blank" href="https://spring.io/blog/2015/10/19/springone2gx-2015-replay-spring-cloud-at-netflix">Spring Cloud at Netflix</a></li>
                     
                        <li><a target="_blank" href="https://spring.io/blog/2015/07/14/microservices-with-spring">Microservices with Spring</a></li>
                     
                        <li><a target="_blank" href="https://spring.io/guides#tutorials">Spring Guides</a></li>
                     
                        <li><a target="_blank" href="https://network.pivotal.io/">Pivotal Network</a></li>
                     
                        <li><a target="_blank" href="http://docs.pivotal.io">Pivotal Documentation</a></li>
                     
					</ul>
				</li>
			
			
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Books<span class="caret"></span></a>
					<ul class="dropdown-menu" role="menu">
					
                        <li><a target="_blank" href="/books/Beyond_the_12-Factor_App_Pivotal.pdf">Beyond the 12-Factor App</a></li>
                     
                        <li><a target="_blank" href="/books/Migrating_to_Cloud-Native_App_Architectures_Pivotal.pdf">Migrating to Cloud Native Application Architectures</a></li>
                     
                        <li><a target="_blank" href="/books/Cloud_Foundry_The_Cloud_Native_Platform_Pivotal.pdf">Cloud Foundry The Cloud Native Platform</a></li>
                     
                        <li><a target="_blank" href="http://www.amazon.com/Cloud-Native-Java-Designing-Resilient/dp/1449374646">Cloud Native Java: Designing Resilient Systems with Spring Boot, Spring Cloud, and Cloud Foundry</a></li>
                     
					</ul>
				</li>
			
				
                        
				</ul>
			</div>
		</div>
	</nav>

<div class="container" style="width:95%; padding:5">
	<div class="row">

	    		
		<div class="doc-sidebar" style="width:30%; margin-top:0; float:right; padding:10px;">
			<div class="sidebar-module">
				
		    	<div class="tag-box bg-dark-11" style="padding:10px; margin:20px;">
		    	<h4 class="type-brand-3">Books</h4>
		    	<ul class="list-unstyled">
		    	
		    	<li><a target="_blank" href="/books/Beyond_the_12-Factor_App_Pivotal.pdf">Beyond the 12-Factor App</a><p></p></li>	
		    	
		    	<li><a target="_blank" href="/books/Migrating_to_Cloud-Native_App_Architectures_Pivotal.pdf">Migrating to Cloud Native Application Architectures</a><p></p></li>	
		    	
		    	<li><a target="_blank" href="/books/Cloud_Foundry_The_Cloud_Native_Platform_Pivotal.pdf">Cloud Foundry The Cloud Native Platform</a><p></p></li>	
		    	
		    	<li><a target="_blank" href="http://www.amazon.com/Cloud-Native-Java-Designing-Resilient/dp/1449374646">Cloud Native Java: Designing Resilient Systems with Spring Boot, Spring Cloud, and Cloud Foundry</a><p></p></li>	
		    	
		    	</ul>
		  	</div>
                        <div class="tag-box bg-dark-11" style="padding:10px; margin:20px;">
                        <h4 class="type-brand-3">Resources</h4>
                        <ul class="list-unstyled">
                        
                            <li><a target="_blank" href="https://www.youtube.com/playlist?list=PLAdzTan_eSPQ1fuLSBhyB4eEZF7JQM0Mx">All SpringOne Conference Videos</a><p></p></li>
                        
                            <li><a target="_blank" href="http://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry-dev/introduction">Try PCF on your Local Workstation with PCF Dev</a><p></p></li>
                        
                            <li><a target="_blank" href="http://pivotal.io/platform/pcf-tutorials/getting-started-with-pivotal-cloud-foundry/introduction">Try PCF on the Public Cloud</a><p></p></li>
                        
                            <li><a target="_blank" href="/CorporateOverview.pdf">Pivotal Overview</a><p></p></li>
                        
                            <li><a target="_blank" href="https://network.pivotal.io/products/pcfdev">PCF Dev</a><p></p></li>
                        
                            <li><a target="_blank" href="https://docs.pivotal.io/pivotalcf">PCF Documentation</a><p></p></li>
                        
                            <li><a target="_blank" href="https://docs.pivotal.io/pivotalcf/cf-cli/getting-started.html">CF CLI Documentation</a><p></p></li>
                        
                            <li><a target="_blank" href="https://www.git-scm.com">Git</a><p></p></li>
                        
                            <li><a target="_blank" href="https://try.github.io/levels/1/challenges/1">Git Lessons</a><p></p></li>
                        
                            <li><a target="_blank" href="http://platform.spring.io/platform/">Spring Platform</a><p></p></li>
                        
                            <li><a target="_blank" href="https://spring.io/docs">Spring Docs</a><p></p></li>
                        
                            <li><a target="_blank" href="http://start.spring.io/">Spring Initializer</a><p></p></li>
                        
                            <li><a target="_blank" href="https://spring.io/blog/2015/10/19/springone2gx-2015-replay-spring-cloud-at-netflix">Spring Cloud at Netflix</a><p></p></li>
                        
                            <li><a target="_blank" href="https://spring.io/blog/2015/07/14/microservices-with-spring">Microservices with Spring</a><p></p></li>
                        
                            <li><a target="_blank" href="https://spring.io/guides#tutorials">Spring Guides</a><p></p></li>
                        
                            <li><a target="_blank" href="https://network.pivotal.io/">Pivotal Network</a><p></p></li>
                        
                            <li><a target="_blank" href="http://docs.pivotal.io">Pivotal Documentation</a><p></p></li>
                        
                        </ul>
                        </div>
			</div>
		</div>
		


		<div class="col-sm-8 doc-main" style="width:70%; float:left; padding:30px;">
			<main role="main">
				<article>
					<a id="title"></a>
					<div class="doc-entry-meta">
					</div>
					<section>
						<div class="sect1">
<h2 id="_lab_7_running_publishing_and_deploying_asp_net_core_micro_services">Lab 7 - Running, Publishing and Deploying ASP.NET Core Micro-services</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_code_goal_code"><code>Goal</code></h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">In this lab</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>We&#8217;ll become comfortable with running ASP.NET Core Web applications locally</p>
</li>
<li>
<p>Push the application to Cloud-Foundry</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Approximate time: 1 hour</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The completed code for this lab can be found at <code>$COURSE_HOME/dotnet/lab05/</code>.
</td>
</tr>
</table>
</div>
<div class="quoteblock abstract">
<blockquote>
<div class="paragraph">
<p>In this lab we will become comfortable with running ASP.NET Core Web applications locally on our PC and publishing and deploying them to Cloud Foundry.</p>
</div>
<div class="paragraph">
<p>We will be using a <code>Fortune Teller</code> micro-services based application as our sample.
The app consists of a <code>Fortune Teller Service</code> which provides a REST API to serve up Fortunes and a <code>Fortune Teller UI</code> that can be used to display the Fortunes.
In its current state, this app is not fully functional.
The <code>Fortune Teller Service</code> only serves up a single Fortune and the <code>Fortune Teller UI</code> doesn&#8217;t know how to communicate with the <code>Fortune Teller Service</code> so it always returns a single <code>Hello world</code> Fortune.</p>
</div>
<div class="paragraph">
<p>In this lab we will work with both of them, running them locally and pushing them to Cloud Foundry in their current state.
In future labs we will systematically make the changes necessary to make them a working application.</p>
</div>
<div class="paragraph">
<p>Note: If you are doing this Lab on a Mac you will need to install Mono. The simple way to do that is to use <code>brew</code>. At a command prompt enter <code>brew install mono</code>. Once complete you will need to export an environment variable in the command window you will be working within in order to work around a problem with the <code>dotnet</code> tooling.  To do this, you will first need to locate where <code>brew</code> installed Mono. Then, once you have that determined then you will need to use that information to export the path to the Mono core libraries. Something like this:  <code>export FrameworkPathOverride=/usr/local/Cellar/mono/4.8.0.495/lib/mono/4.5/</code> will need to be entered.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_open_visual_studio_solution">Open Visual Studio Solution</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start Visual Studio and open the solution/folder  <em>$COURSE_HOME/dotnet/Lab05.sln</em></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open <em>Fortune-Teller-Service/Fortune-Teller-Service.csproj</em> or  <em>Fortune-Teller-UI/Fortune-Teller-UI.csproj</em>.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Notice the <code>TargetFrameworks</code> specifies <code>netcoreapp1.1</code> and <code>net462</code>. This ASP.NET Core app is intended to run on <code>.NET Core 1.1</code> and <code>.NET Framework 4.6.2</code>.</p>
</li>
<li>
<p>Notice the <code>PackageReference</code> items as they specify all the NuGets the application depends on.</p>
</li>
<li>
<p>Notice the <code>RuntimeIdentifiers</code> specifies what runtimes you can publish this application for.  When targeting .NET Core, this causes the app to be fully self-contained when published. Otherwise without it we get a <code>portable</code> app.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If your using Visual Studio 2017 you can open the Debug Launch dropdown.</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>Notice <code>Framework</code> selection allows either <code>netcoreapp1.1</code> or <code>net462</code> to be selected.</p>
</li>
<li>
<p>Notice hosting environment can be <code>IIS Express</code> or <code>Fortune-Teller-Service</code> and either can be selected.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_service_in_vs2017_on_net_4_x_windows_only">Run Fortune Teller Service in VS2017, on .NET 4.x (Windows only)</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start Visual Studio 2017 and open the solution <em>$COURSE_HOME/dotnet/Lab05.sln</em></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set <code>Fortune-Teller-Service</code> as active project (i.e. Select Project&#8594;Right Click&#8594;Set As Startup project)</p>
</li>
<li>
<p>Select  <code>Framework</code> to be <code>.NET 4.6.2</code></p>
</li>
<li>
<p>Select a <code>Hosting environment</code> to be <code>Fortune_Teller_Service</code></p>
</li>
<li>
<p>Start application (e.g. CTRL-F5 or F5)</p>
</li>
<li>
<p>Notice command window opens with app running</p>
</li>
<li>
<p>Open browser and hit REST endpoint <code><a href="http://localhost:5000/api/fortunes/all" class="bare">http://localhost:5000/api/fortunes/all</a></code>.</p>
</li>
<li>
<p>Try setting breakpoints in the FortunesController if you&#8217;re running in the debugger.</p>
</li>
<li>
<p>How does port 5000 get selected to be used on startup? Look at <code>launchSettings.json</code>.</p>
</li>
<li>
<p>Stop the app, and change it to run under IIS Express.</p>
</li>
<li>
<p>Notice no command window opens with app running.</p>
</li>
<li>
<p>Use browser to hit the REST endpoint.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_service_in_vs2017_on_net_core_windows_only">Run Fortune Teller Service in VS2017, on .NET Core (Windows only)</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start Visual Studio 2017 and open the solution <em>$COURSE_HOME/dotnet/Lab05.sln</em></p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set <code>Fortune-Teller-Service</code> as active project (i.e. Select Project&#8594;Right Click&#8594;Set As Startup project)</p>
</li>
<li>
<p>Select  <code>Framework</code> to be <code>.NET Core App, 1.1</code></p>
</li>
<li>
<p>Select a <code>Hosting environment</code> to be <code>Fortune_Teller_Service</code></p>
</li>
<li>
<p>Start application (e.g. CTRL-F5 or F5)</p>
</li>
<li>
<p>Try setting breakpoints in the FortunesController if you&#8217;re running in the debugger.</p>
</li>
<li>
<p>Notice command window opens with app running</p>
</li>
<li>
<p>Open browser and hit REST endpoint <code><a href="http://localhost:5000/api/fortunes/all" class="bare">http://localhost:5000/api/fortunes/all</a></code>.</p>
</li>
<li>
<p>Stop the app, and change it to run under IIS Express.</p>
</li>
<li>
<p>Notice no command window opens with app running.</p>
</li>
<li>
<p>Use browser to hit the REST endpoint.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_ui_in_vs2017_both_on_net_4_x_and_net_core_windows_only">Run Fortune Teller UI in VS2017, both on .NET 4.x and .NET Core (Windows only)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hint: Shutdown Fortune Service before proceeding</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the instructions above, but apply them to the Fortune Teller UI.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_service_in_command_window_on_net_4_x_windows_only">Run Fortune Teller Service in Command Window on .NET 4.x (Windows only)</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On Windows make sure the path variable points to bower executable directory. If you have Visual Studio 2017 installed, this should work.</p>
<div class="literalblock">
<div class="content">
<pre>C:\Program Files (x86)\Microsoft Visual Studio 14.0\Web\External</pre>
</div>
</div>
</li>
<li>
<p>Start a command window.</p>
</li>
<li>
<p>Change directory to the <code>Fortune Teller Service</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; cd $COURSE_HOME/dotnet/Lab05/Fortune-Teller-Service</pre>
</div>
</div>
</li>
<li>
<p>Restore the nuget dependencies for the application</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet restore</pre>
</div>
</div>
</li>
<li>
<p>Run the application on .NET 4.x</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet run -f net462</pre>
</div>
</div>
</li>
<li>
<p>Hit the REST endpoint <code><a href="http://localhost:5000/api/fortunes/all" class="bare">http://localhost:5000/api/fortunes/all</a></code>.</p>
</li>
<li>
<p>Examine help for <code>dotnet run</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet run -h</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_service_in_command_window_on_net_core">Run Fortune Teller Service in Command Window on .NET Core</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a command window.</p>
</li>
<li>
<p>Change directory to the <code>Fortune Teller Service</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; cd $COURSE_HOME/dotnet/Lab05/Fortune-Teller-Service</pre>
</div>
</div>
</li>
<li>
<p>Restore the nuget dependencies for the application</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet restore</pre>
</div>
</div>
</li>
<li>
<p>Run the application on .NET Core</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet run -f netcoreapp1.1</pre>
</div>
</div>
</li>
<li>
<p>Hit the REST endpoint <code><a href="http://localhost:5000/api/fortunes/all" class="bare">http://localhost:5000/api/fortunes/all</a></code>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_run_fortune_teller_ui_in_command_window_both_on_net_4_x_and_net_core">Run Fortune Teller UI in Command Window, both on .NET 4.x and .NET Core</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the instructions above, but apply them to the Fortune Teller UI.</p>
</li>
<li>
<p>Hint: You can specify what port the server listens on as follows:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>dotnet run -f netcoreapp1.1 --server.urls <a href="http://*:5555" class="bare">http://*:5555</a></p>
</li>
<li>
<p>dotnet run -f net462 --server.urls <a href="http://*:5555" class="bare">http://*:5555</a></p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_and_push_fortune_teller_service_to_cloud_foundry_linux_cell">Publish and Push Fortune Teller Service to Cloud Foundry Linux Cell</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a command window.</p>
</li>
<li>
<p>Change directory to the <code>Fortune Teller Service</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; cd $COURSE_HOME/dotnet/Lab05/Fortune-Teller-Service</pre>
</div>
</div>
</li>
<li>
<p>Restore the nuget dependencies for the application</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet restore</pre>
</div>
</div>
</li>
<li>
<p>Remove any previously published artifacts if they exist</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Windows: rmdir /s /q .\publish

&gt; Mac/Linux: rm -rf publish</pre>
</div>
</div>
</li>
<li>
<p>Publish for Ubuntu and .NET Core,</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Windows: dotnet publish -f netcoreapp1.1 -r ubuntu.14.04-x64 -o %CD%\publish

&gt; Mac/Linux: dotnet publish -f netcoreapp1.1 -r ubuntu.14.04-x64 -o $PWD/publish</pre>
</div>
</div>
</li>
<li>
<p>In Visual Studio, examine the <code>manifest.yml</code> and <code>manifest-windows.yml</code> files.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>manifest.yml</code> &#8594; for pushing to Linux cell</p>
</li>
<li>
<p><code>manifest-windows.yml</code> &#8594; for pushing to Windows cell</p>
</li>
</ol>
</div>
</li>
<li>
<p>Push the published app to a Linux cell using <code>manifest.yml</code>.</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Windows: cf push -f manifest.yml -p .\publish

&gt; Mac/Linux: cf push -f manifest.yml -p publish</pre>
</div>
</div>
</li>
<li>
<p>Hit the REST endpoint using the route that was generated by the CLI and adding <code>/api/fortunes/all</code> to it:</p>
<div class="imageblock">
<div class="content">
<img src="/images/lab-05-fortuneservice-all.png" alt="lab 05 fortuneservice all">
</div>
</div>
<div class="paragraph">
<p><br></p>
</div>
</li>
<li>
<p>Examine help for <code>dotnet publish</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet publish -h</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_and_push_fortune_teller_ui_to_cloud_foundry_linux_cell">Publish and Push Fortune Teller UI to Cloud Foundry Linux Cell</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the instructions above, but apply them to the Fortune Teller UI.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_for_net_4_and_push_fortune_teller_service_to_cloud_foundry_windows_cell">Publish for .NET 4 and Push Fortune Teller Service to Cloud Foundry Windows Cell</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start a command window.</p>
</li>
<li>
<p>Change directory to the <code>Fortune Teller Service</code></p>
<div class="listingblock">
<div class="content">
<pre>&gt; cd $COURSE_HOME/dotnet/Lab05/Fortune-Teller-Service</pre>
</div>
</div>
</li>
<li>
<p>Restore the nuget dependencies for the application</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet restore</pre>
</div>
</div>
</li>
<li>
<p>Remove any previously published artifacts if they exist</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Windows: rmdir /s /q .\publish

&gt; Mac/Linux: rm -rf publish</pre>
</div>
</div>
</li>
<li>
<p>Publish for Windows and .NET 4.6.2</p>
<div class="listingblock">
<div class="content">
<pre>&gt; dotnet publish -f net462 -r win10-x64 -o %CD%\publish</pre>
</div>
</div>
</li>
<li>
<p>In Visual Studio, examine the <code>manifest.yml</code> and <code>manifest-windows.yml</code> files.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>manifest.yml</code> &#8594; for pushing to Linux cell</p>
</li>
<li>
<p><code>manifest-windows.yml</code> &#8594; for pushing to Windows cell</p>
</li>
</ol>
</div>
</li>
<li>
<p>Push the published app to a Windows cell using <code>manifest-windows.yml</code>.</p>
<div class="listingblock">
<div class="content">
<pre>&gt; cf push -f manifest-windows.yml -p .\publish</pre>
</div>
</div>
</li>
<li>
<p>Hit the REST endpoint using the route that was generated by the CLI and adding <code>/api/fortunes/all</code> to it:</p>
<div class="imageblock">
<div class="content">
<img src="/images/lab-05-fortuneservice-all.png" alt="lab 05 fortuneservice all">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_for_net_core_and_push_fortune_teller_service_to_cloud_foundry_windows_cell">Publish for .NET Core and Push Fortune Teller Service to Cloud Foundry Windows Cell</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use instructions above, but instead cause the app to run on .NET Core on a Windows cell.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_publish_net_core_and_net_4_and_push_fortune_teller_ui_to_cloud_foundry_windows_cell">Publish .NET Core and .NET 4 and Push Fortune Teller UI to Cloud Foundry Windows Cell</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the instructions above, but apply them to the Fortune Teller UI.</p>
</li>
</ol>
</div>
</div>
</div>

					</section>
				</article>
			</main>
		</div> 
	</div> 
</div>

		




<hr />
<div class="container">
	<div class="row">
		<div class="col-sm-8">
			<p class="doc-footer-em"><a href="#">Back to TOP</a></p>
		</div>
	</div>

</div> 
          
<footer class="doc-footer">
        <span>Last Updated on  2016-03-23 19:58:14 -0400 EDT  </span>
	
	<p>Copyright (c) 2015, Pivotal; All rights reserved.</p>
</footer>



<script src="/js/jquery-1.11.2.min.js"></script>
<script src="/js/bootstrap.min.js"></script>

<script src="/js/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="/js/ie10-viewport-bug-workaround.js"></script>
		<script>
			var $event = $.event,
			$special,
			resizeTimeout;
			$special = $event.special.debouncedresize = {
				setup: function() {
					$( this ).on( "resize", $special.handler );
				},
				teardown: function() {
					$( this ).off( "resize", $special.handler );
				},
				handler: function( event, execAsap ) {
					var context = this,
						args = arguments,
						dispatch = function() {
							event.type = "debouncedresize";
							$event.dispatch.apply( context, args );
						};
					if ( resizeTimeout ) {
						clearTimeout( resizeTimeout );
					}
					execAsap ?
						dispatch() :
						resizeTimeout = setTimeout( dispatch, $special.threshold );
				},
				threshold: 250
			};
			var BLANK = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==';
			$.fn.imagesLoaded = function( callback ) {
				var $this = this,
					deferred = $.isFunction($.Deferred) ? $.Deferred() : 0,
					hasNotify = $.isFunction(deferred.notify),
					$images = $this.find('img').add( $this.filter('img') ),
					loaded = [],
					proper = [],
					broken = [];
				if ($.isPlainObject(callback)) {
					$.each(callback, function (key, value) {
						if (key === 'callback') {
							callback = value;
						} else if (deferred) {
							deferred[key](value);
						}
					});
				}
				function doneLoading() {
					var $proper = $(proper),
						$broken = $(broken);
					if ( deferred ) {
						if ( broken.length ) {
							deferred.reject( $images, $proper, $broken );
						} else {
							deferred.resolve( $images );
						}
					}
					if ( $.isFunction( callback ) ) {
						callback.call( $this, $images, $proper, $broken );
					}
				}
				function imgLoaded( img, isBroken ) {
					if ( img.src === BLANK || $.inArray( img, loaded ) !== -1 ) {
						return;
					}
					loaded.push( img );
					if ( isBroken ) {
						broken.push( img );
					} else {
						proper.push( img );
					}
					$.data( img, 'imagesLoaded', { isBroken: isBroken, src: img.src } );
					if ( hasNotify ) {
						deferred.notifyWith( $(img), [ isBroken, $images, $(proper), $(broken) ] );
					}
					if ( $images.length === loaded.length ){
						setTimeout( doneLoading );
						$images.unbind( '.imagesLoaded' );
					}
				}
				if ( !$images.length ) {
					doneLoading();
				} else {
					$images.bind( 'load.imagesLoaded error.imagesLoaded', function( event ){
						imgLoaded( event.target, event.type === 'error' );
					}).each( function( i, el ) {
						var src = el.src;
						var cached = $.data( el, 'imagesLoaded' );
						if ( cached && cached.src === src ) {
							imgLoaded( el, cached.isBroken );
							return;
						}
						if ( el.complete && el.naturalWidth !== undefined ) {
							imgLoaded( el, el.naturalWidth === 0 || el.naturalHeight === 0 );
							return;
						}
						if ( el.readyState || el.complete ) {
							el.src = BLANK;
							el.src = src;
						}
					});
				}
				return deferred ? deferred.promise( $this ) : $this;
			};
			var Grid = (function() {
				var $grid = $( '#og-grid' ),
					$items = $grid.children( 'li' ),
					current = -1,
					previewPos = -1,
					scrollExtra = 0,
					marginExpanded = 10,
					$window = $( window ), winsize,
					$body = $( 'html, body' ),
					transEndEventNames = {
						'WebkitTransition' : 'webkitTransitionEnd',
						'MozTransition' : 'transitionend',
						'OTransition' : 'oTransitionEnd',
						'msTransition' : 'MSTransitionEnd',
						'transition' : 'transitionend'
					},
					transEndEventName = transEndEventNames[ Modernizr.prefixed( 'transition' ) ],
					support = Modernizr.csstransitions,
					settings = {
						minHeight : 500,
						speed : 350,
						easing : 'ease'
					};
				function init( config ) {
					
					settings = $.extend( true, {}, settings, config );
					$grid.imagesLoaded( function() {
						saveItemInfo( true );
						getWinSize();
						initEvents();
					} );
				}
				function addItems( $newitems ) {
					$items = $items.add( $newitems );
					$newitems.each( function() {
						var $item = $( this );
						$item.data( {
							offsetTop : $item.offset().top,
							height : $item.height()
						} );
					} );
					initItemsEvents( $newitems );
				}
				function saveItemInfo( saveheight ) {
					$items.each( function() {
						var $item = $( this );
						$item.data( 'offsetTop', $item.offset().top );
						if( saveheight ) {
							$item.data( 'height', $item.height() );
						}
					} );
				}
				function initEvents() {
					
					initItemsEvents( $items );
					
					$window.on( 'debouncedresize', function() {
						
						scrollExtra = 0;
						previewPos = -1;
						saveItemInfo();
						getWinSize();
						var preview = $.data( this, 'preview' );
						if( typeof preview != 'undefined' ) {
							hidePreview();
						}
					} );
				}
				function initItemsEvents( $items ) {
					$items.on( 'click', 'span.og-close', function() {
						hidePreview();
						return false;
					} ).children( 'a' ).on( 'click', function(e) {
						var $item = $( this ).parent();
						current === $item.index() ? hidePreview() : showPreview( $item );
						return false;
					} );
				}
				function getWinSize() {
					winsize = { width : $window.width(), height : $window.height() };
				}
				function showPreview( $item ) {
					var preview = $.data( this, 'preview' ),
						position = $item.data( 'offsetTop' );
					scrollExtra = 0;
					if( typeof preview != 'undefined' ) {
						if( previewPos !== position ) {
							if( position > previewPos ) {
								scrollExtra = preview.height;
							}
							hidePreview();
						}
						else {
							preview.update( $item );
							return false;
						}
						
					}
					previewPos = position;
					preview = $.data( this, 'preview', new Preview( $item ) );
					preview.open();
				}
				function hidePreview() {
					current = -1;
					var preview = $.data( this, 'preview' );
					preview.close();
					$.removeData( this, 'preview' );
				}
				function Preview( $item ) {
					this.$item = $item;
					this.expandedIdx = this.$item.index();
					this.create();
					this.update();
				}
				Preview.prototype = {
					create : function() {
						this.$title = $( '<h3></h3>' );
						this.$description = $( '<p></p>' );
						this.$href = $( '<a href="#"></a>' );
						this.$details = $( '<div class="og-details"></div>' ).append( this.$title, this.$description, this.$href );
						this.$loading = $( '<div class="og-loading"></div>' );
						this.$fullimage = $( '<div class="og-fullimg"></div>' ).append( this.$loading );
						this.$closePreview = $( '<span class="og-close"></span>' );
						this.$previewInner = $( '<div class="og-expander-inner"></div>' ).append( this.$closePreview, this.$fullimage, this.$details );
						this.$previewEl = $( '<div class="og-expander"></div>' ).append( this.$previewInner );
						this.$item.append( this.getEl() );
						if( support ) {
							this.setTransition();
						}
					},
					update : function( $item ) {
						if( $item ) {
							this.$item = $item;
						}
						
						if( current !== -1 ) {
							var $currentItem = $items.eq( current );
							$currentItem.removeClass( 'og-expanded' );
							this.$item.addClass( 'og-expanded' );
							this.positionPreview();
						}
						current = this.$item.index();
						var $itemEl = this.$item.children( 'a' ),
							eldata = {
								href : $itemEl.attr( 'href' ),
								largesrc : $itemEl.data( 'largesrc' ),
								title : $itemEl.data( 'title' ),
								description : $itemEl.data( 'description' )
							};
						this.$title.html( eldata.title );
						this.$description.html( eldata.description );
						this.$href.attr( 'href', eldata.href );
						var self = this;
						
						if( typeof self.$largeImg != 'undefined' ) {
							self.$largeImg.remove();
						}
						if( self.$fullimage.is( ':visible' ) ) {
							this.$loading.show();
							$( '<img/>' ).load( function() {
								var $img = $( this );
								if( $img.attr( 'src' ) === self.$item.children('a').data( 'largesrc' ) ) {
									self.$loading.hide();
									self.$fullimage.find( 'img' ).remove();
									self.$largeImg = $img.fadeIn( 350 );
									self.$fullimage.append( self.$largeImg );
								}
							} ).attr( 'src', eldata.largesrc );	
						}
					},
					open : function() {
						setTimeout( $.proxy( function() {	
							this.setHeights();
							this.positionPreview();
						}, this ), 25 );
					},
					close : function() {
						var self = this,
							onEndFn = function() {
								if( support ) {
									$( this ).off( transEndEventName );
								}
								self.$item.removeClass( 'og-expanded' );
								self.$previewEl.remove();
							};
						setTimeout( $.proxy( function() {
							if( typeof this.$largeImg !== 'undefined' ) {
								this.$largeImg.fadeOut( 'fast' );
							}
							this.$previewEl.css( 'height', 0 );
							var $expandedItem = $items.eq( this.expandedIdx );
							$expandedItem.css( 'height', $expandedItem.data( 'height' ) ).on( transEndEventName, onEndFn );
							if( !support ) {
								onEndFn.call();
							}
						}, this ), 25 );
						
						return false;
					},
					calcHeight : function() {
						var heightPreview = winsize.height - this.$item.data( 'height' ) - marginExpanded,
							itemHeight = winsize.height;
						if( heightPreview < settings.minHeight ) {
							heightPreview = settings.minHeight;
							itemHeight = settings.minHeight + this.$item.data( 'height' ) + marginExpanded;
						}
						this.height = heightPreview;
						this.itemHeight = itemHeight;
					},
					setHeights : function() {
						var self = this,
							onEndFn = function() {
								if( support ) {
									self.$item.off( transEndEventName );
								}
								self.$item.addClass( 'og-expanded' );
							};
						this.calcHeight();
						this.$previewEl.css( 'height', this.height );
						this.$item.css( 'height', this.itemHeight ).on( transEndEventName, onEndFn );
						if( !support ) {
							onEndFn.call();
						}
					},
					positionPreview : function() {
						var position = this.$item.data( 'offsetTop' ),
							previewOffsetT = this.$previewEl.offset().top - scrollExtra,
							scrollVal = this.height + this.$item.data( 'height' ) + marginExpanded <= winsize.height ? position : this.height < winsize.height ? previewOffsetT - ( winsize.height - this.height ) : previewOffsetT;
						
						$body.animate( { scrollTop : scrollVal }, settings.speed );
					},
					setTransition  : function() {
						this.$previewEl.css( 'transition', 'height ' + settings.speed + 'ms ' + settings.easing );
						this.$item.css( 'transition', 'height ' + settings.speed + 'ms ' + settings.easing );
					},
					getEl : function() {
						return this.$previewEl;
					}
				}
				return { 
					init : init,
					addItems : addItems
				};
			})();
		</script>
		<script>
			$(function() {
				Grid.init();
			});
		</script>
</body>
</html>

